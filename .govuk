function replicate {
  if [[ $OSTYPE == darwin* ]] ; then
    echo "You are not inside vagrant to run this command."
  else
    development replication

    read -p "Would you like to remove backups? (y/n) " -n 1;
    echo ""
    if [[ $REPLY =~ ^[Yy]$ ]]; then
      echo "deleting your local backups..."
      rm -rf backups
    fi;

    read -r -p "Your username: " username;
    echo ""
    ./replicate-data-local.sh -F ../ssh_config -u $username
  fi;
}

# usage: bowlme www whitehall
#
# when finished, you can go back to your previous directory
# by typing `cd -`
function bowlme {
  if [[ pwd -eq vm_directory ]] ; then
    development && bowl $@
  else
    OLDPWD=$(pwd)
    development && bowl $@
  fi;
}

function vm_directory {
  cd ~/govuk/govuk-puppet/development-vm/
}

function vm {
  if [[ $OSTYPE == darwin* ]] ; then
     vm_directory && vagrant ssh
  else
    echo "Sorry, you are already inside vagrant."
  fi;
}

function vmup {
  if [[ $OSTYPE == darwin* ]] ; then
     vm_directory && vagrant up && vagrant ssh
  else
    echo "Sorry, you are already inside vagrant."
  fi;
}

# usage: govuk [TAB][TAB]
function govuk {
  if [[ $OSTYPE == darwin* ]] ; then
    cd ~/govuk/$1
  else
    cd /var/govuk/$1
  fi;
}

# function to autocomplete govuk directory
# 
# TODO: Improve performance under OSX, the reason it's so slow is because
#  OSX doesn't support `dir` command, so I had to find a different hack,
#  hopefully someone with more knowledge can help this
_govuk() {
  local cur prev opts
  COMPREPLY=()

  cur="${COMP_WORDS[COMP_CWORD]}"
  prev="${COMP_WORDS[COMP_CWORD-1]}"

  if [[ $OSTYPE == darwin* ]] ; then
    opts=$(find ~/govuk -type d -depth 1 | sed 's@.*/@@')
  else
    opts=$(dir /var/govuk)
  fi;

  COMPREPLY=( $(compgen -W "${opts}" -- ${cur}) )
  return 0
}
complete -F _govuk govuk


function development {
  if [[ $OSTYPE == darwin* ]] ; then
    cd ~/govuk/development/$1
  else
    cd /var/govuk/development/$1
  fi;
}

function mongoup {
  sudo rm /var/lib/mongodb/mongod.lock && sudo service mongodb start
}

# boxen
[ -f /opt/boxen/env.sh ] && source /opt/boxen/env.sh
